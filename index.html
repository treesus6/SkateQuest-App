<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
        <meta name="theme-color" content="#FF5722" />
        
        <title>SkateQuest üõπ - Real Tricks Only</title>
        
        <!-- SEO Meta Tags -->
        <meta name="description" content="SkateQuest - Where real skateboarding tricks count. Challenge skaters, prove your skills with video, find skateparks, and help kids get boards." />
        <meta name="keywords" content="skateboarding, skate challenges, real tricks, skate spots, skateboard community, QR treasure hunt, skateboard donations" />
        <meta name="author" content="SkateQuest" />
        
        <!-- Open Graph Tags -->
        <meta property="og:title" content="SkateQuest - Real Tricks Only" />
        <meta property="og:description" content="Challenge skaters to real tricks. Film your proof. Give back to the community." />
        <meta property="og:image" content="https://www.sk8.quest/icons/skatequest-icon-512.png" />
        <meta property="og:url" content="https://www.sk8.quest" />
        <meta property="og:type" content="website" />
        
        <!-- Twitter Card Tags -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content="SkateQuest - Real Skateboarding Challenges" />
        <meta name="twitter:description" content="No controllers. No fake tricks. Just real skateboarding." />
        <meta name="twitter:image" content="https://www.sk8.quest/icons/skatequest-icon-512.png" />
        
        <!-- PWA Tags -->
        <link rel="manifest" href="manifest.json" />
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="apple-mobile-web-app-title" content="SkateQuest">
        
        <!-- Icons -->
        <link rel="icon" href="icons/skatequest-icon-192.png" />
        <link rel="apple-touch-icon" href="icons/skatequest-icon-192.png">
        
        <!-- Stylesheets -->
        <link rel="stylesheet" href="style.css?v=2.0" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    </head>
    <body>
        <!-- Header -->
        <header>
            <h1>SK8.QUEST üõπ</h1>
            <div class="badge-real-tricks">Real Tricks Only</div>
        </header>

        <div class="app-container">
            <!-- Sidebar Navigation -->
            <aside class="sidebar">
                <nav class="side-nav">
                    <button id="discoverBtn" class="active">üó∫Ô∏è Discover</button>
                    <button id="challengesBtn">‚ö° Challenges</button>
                    <button id="qrHuntBtn">üîç QR Hunt</button>
                    <button id="givingBackBtn">‚ù§Ô∏è Give Back</button>
                    <button id="addSpotBtn">‚ûï Add Spot</button>
                    <button id="profileBtn">üë§ Profile</button>
                    <button id="legalBtn">üìú Legal</button>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="main-area">
                <!-- Map -->
                <div id="map"></div>

                <!-- Content Sections -->
                <section id="content">
                    
                    <!-- DAILY CHALLENGE BANNER -->
                    <div id="daily-challenge-banner" class="panel" style="display:none;">
                        <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1rem;">
                            <div>
                                <div style="font-size:0.8rem; text-transform:uppercase; color:var(--primary-orange); font-weight:bold;">üî• Daily Challenge</div>
                                <h3 id="daily-challenge-trick" style="margin:0.5rem 0; font-size:1.8rem;"></h3>
                                <div id="daily-challenge-meta" style="display:flex; gap:1rem; font-size:0.9rem; color:var(--text-secondary);"></div>
                            </div>
                            <div style="text-align:right;">
                                <div id="daily-challenge-time" style="font-size:0.9rem; color:var(--text-secondary);"></div>
                                <div id="daily-challenge-points" style="font-size:2rem; font-weight:900; color:var(--primary-orange);"></div>
                            </div>
                        </div>
                        <button id="accept-daily-challenge" class="btn-primary" style="margin-top:1rem; width:100%;">Accept Challenge</button>
                    </div>

                    <!-- GIVING BACK BANNER -->
                    <div id="giving-back-banner" class="giving-back-banner" style="display:none;">
                        <h3 style="margin:0 0 1rem 0;">Skateboarding Saves Lives ‚ù§Ô∏è</h3>
                        <p style="margin-bottom:1rem;">Every QR code you buy helps fund skateboards for kids who can't afford them.</p>
                        <div class="impact-stats">
                            <div class="stat-card">
                                <div class="stat-number" id="total-raised">$0</div>
                                <div class="stat-label">Raised</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="boards-donated">0</div>
                                <div class="stat-label">Boards Donated</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="active-qrs">0</div>
                                <div class="stat-label">Active QRs</div>
                            </div>
                        </div>
                        <button class="btn-primary" style="margin-top:1rem; width:100%;" onclick="showQRPurchase()">Buy QR Codes</button>
                    </div>

                    <!-- LEADERBOARD -->
                    <section id="leaderboard" class="panel">
                        <h2>üèÜ Top Skaters</h2>
                        <div id="leaderboard-list">
                            <div>Loading leaderboard...</div>
                        </div>
                    </section>

                    <!-- PENDING CHALLENGES -->
                    <section id="pending-challenges" class="panel">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                            <h2 style="margin:0;">‚ö° Call-Out Challenges</h2>
                            <button class="btn-primary" id="create-challenge-btn">+ Issue Challenge</button>
                        </div>
                        <div id="pending-challenges-list">
                            <div style="text-align:center; padding:2rem; color:var(--text-secondary);">
                                Loading challenges...
                            </div>
                        </div>
                    </section>

                    <!-- CHALLENGE PANEL (for creating challenges) -->
                    <section id="challenge-panel" class="panel" style="display:none;">
                        <h2>Call-Out Trick Challenge</h2>
                        <form id="create-challenge-form">
                            <label>Select Spot:</label>
                            <select id="spot-select" required>
                                <option value="" disabled selected>Choose a spot</option>
                            </select>

                            <label>Select Trick:</label>
                            <select id="trick-select" required>
                                <option value="" disabled selected>Choose a trick</option>
                                <option value="Kickflip">Kickflip</option>
                                <option value="Heelflip">Heelflip</option>
                                <option value="Tre Flip">Tre Flip</option>
                                <option value="Backside 180">Backside 180</option>
                                <option value="Frontside 180">Frontside 180</option>
                                <option value="50-50 Grind">50-50 Grind</option>
                                <option value="Boardslide">Boardslide</option>
                                <option value="Nosegrind">Nosegrind</option>
                                <option value="Manual">Manual</option>
                                <option value="Ollie">Ollie</option>
                            </select>

                            <label>Challenge Title (optional):</label>
                            <input type="text" id="challenge-title" placeholder="Kickflip over bench" />

                            <label>Description (optional):</label>
                            <textarea id="challenge-desc" placeholder="Land a clean kickflip over the downtown bench" rows="3"></textarea>

                            <label>XP Reward:</label>
                            <input type="number" id="challenge-xp" min="50" max="5000" value="500" required />

                            <label>Challenge Specific User (optional):</label>
                            <input type="text" id="challenger-input" placeholder="Leave blank for open challenge" />

                            <div style="display:flex; gap:1rem; margin-top:1rem;">
                                <button type="submit" class="btn-primary" style="flex:1;">Issue Challenge</button>
                                <button type="button" class="btn-secondary" id="cancel-challenge-btn" style="flex:1;">Cancel</button>
                            </div>
                        </form>
                        <div id="challenge-confirm" style="margin-top:1rem;"></div>
                    </section>

                    <!-- QR HUNT SECTION -->
                    <section id="qr-hunt-section" class="panel qr-hunt-panel" style="display:none;">
                        <h2>üîç QR Treasure Hunt</h2>
                        <p style="margin-bottom:1rem;">Hide QR codes at your favorite spots. When found, they unlock rewards and fund boards for kids! üõπ‚ù§Ô∏è</p>
                        
                        <div class="qr-stats">
                            <div class="qr-stat-box">
                                <div class="stat-number" id="user-qrs-hidden">0</div>
                                <div class="stat-label">You've Hidden</div>
                            </div>
                            <div class="qr-stat-box">
                                <div class="stat-number" id="user-qrs-found">0</div>
                                <div class="stat-label">You've Found</div>
                            </div>
                        </div>

                        <div style="display:flex; flex-direction:column; gap:1rem; margin-top:1.5rem;">
                            <button class="btn-primary" onclick="showQRPurchase()">üí≥ Buy QR Pack - $8</button>
                            <button class="btn-secondary" id="scan-qr-btn">üì± Scan QR Code</button>
                        </div>

                        <div style="margin-top:1rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1); text-align:center; font-size:0.85rem; color:var(--text-muted);">
                            100% of proceeds support skateboarding programs for kids
                        </div>
                    </section>

                    <!-- HOT SPOTS (Featured Skateparks) -->
                    <section id="hot-spots" class="panel" style="display:none;">
                        <h2>üåü Hot Spots Near You</h2>
                        <div id="hot-spots-list"></div>
                    </section>

                    <!-- SPOT FILTERS -->
                    <div id="spot-filters" style="display:none;">
                        <label for="spotFilter">Filter spots:</label>
                        <select id="spotFilter">
                            <option value="all">All Spots</option>
                            <option value="ledge">Ledge</option>
                            <option value="rail">Rail</option>
                            <option value="gap">Gap</option>
                            <option value="stairs">Stairs</option>
                            <option value="bowl">Bowl</option>
                        </select>
                    </div>

                    <!-- PROOF UPLOAD -->
                    <section id="proof-upload" style="display:none;" class="panel">
                        <h2>Upload Challenge Proof üé•</h2>
                        <input type="file" id="proofFile" accept="image/*,video/*" />
                        <button class="btn-primary" style="margin-top:1rem;" onclick="uploadProof()">Upload Proof</button>
                    </section>

                    <!-- CHALLENGE FEED -->
                    <section id="challenge-feed" class="panel" style="display:none;">
                        <h2>Recent Challenge Completions</h2>
                        <div id="challenge-feed-list"></div>
                    </section>

                    <!-- STREAK DISPLAY -->
                    <div id="streak-display" class="panel" style="display:none;"></div>

                    <!-- BADGES -->
                    <div id="badge-display" class="panel" style="display:none;">
                        <h3>Your Badges</h3>
                        <div class="badges" id="user-badges"></div>
                    </div>

                    <!-- RATING UI -->
                    <div id="rating-ui" class="panel" style="display:none;">
                        <label for="rating-select">Rate this spot:</label>
                        <select id="rating-select">
                            <option value="1">‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ</option>
                            <option value="2">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ</option>
                            <option value="3">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</option>
                            <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</option>
                            <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</option>
                        </select>
                        <button id="rating-submit" class="btn-primary">Submit Rating</button>
                    </div>

                    <!-- HEATMAP TOGGLE -->
                    <div style="margin-top:1rem;">
                        <label class="heatmap-toggle">
                            <input type="checkbox" id="heatmap-toggle" /> 
                            Show activity heatmap
                        </label>
                    </div>
                </section>
            </main>
        </div>

        <!-- ====== MODALS ====== -->

        <!-- Custom Modal -->
        <div id="customModal" class="modal" style="display:none;">
            <div class="modal-content">
                <button class="close-button">√ó</button>
                <h3 id="modalTitle">Confirm action</h3>
                <p id="modalText"></p>
                <div style="display:flex; gap:1rem; justify-content:flex-end; margin-top:1.5rem;">
                    <button id="modalCancel" class="btn-secondary">Cancel</button>
                    <button id="modalConfirm" class="btn-primary">Confirm</button>
                </div>
            </div>
        </div>

        <!-- Camera Modal -->
        <div id="cameraModal" class="modal" style="display:none;">
            <div class="modal-content">
                <button class="close-button" id="closeCameraBtn">√ó</button>
                <h3>Record Your Trick üé•</h3>
                <div class="camera-container">
                    <video id="cameraPreview" autoplay playsinline></video>
                    <div class="camera-controls">
                        <button id="recordBtn" class="btn-primary">‚è∫Ô∏è Record</button>
                        <button id="stopRecordBtn" class="btn-primary" style="display:none;">‚èπÔ∏è Stop</button>
                        <button id="saveVideoBtn" class="btn-success" style="display:none;">üíæ Save</button>
                        <button id="cancelCameraBtn" class="btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Legal Modal -->
        <div id="legalModal" class="modal" style="display:none;">
            <div class="modal-content">
                <button class="close-button">√ó</button>
                <h3>Legal Information</h3>
                <div id="legalText" class="legal-content" style="max-height:60vh; overflow-y:auto; padding:1rem;"></div>
            </div>
        </div>

        <!-- QR Purchase Modal -->
        <div id="qrPurchaseModal" class="modal" style="display:none;">
            <div class="modal-content">
                <button class="close-button">√ó</button>
                <h3>Buy QR Code Pack</h3>
                <p>Choose a pack to purchase. QR codes can be printed and hidden at skate spots!</p>
                <div style="display:flex; flex-direction:column; gap:1rem; margin-top:1.5rem;">
                    <button class="btn-primary" onclick="purchaseQRPack(1, 2)">1 QR Code - $2</button>
                    <button class="btn-primary" onclick="purchaseQRPack(5, 8)">5 QR Codes - $8</button>
                    <button class="btn-primary" onclick="purchaseQRPack(10, 15)">10 QR Codes - $15</button>
                </div>
                <p style="margin-top:1rem; font-size:0.85rem; color:var(--text-muted); text-align:center;">
                    100% of proceeds fund skateboard donations for kids
                </p>
            </div>
        </div>

        <!-- Leaflet JS -->
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

        <!-- Firebase SDK -->
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
            import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
            import { getFirestore, doc, getDoc, setDoc, addDoc, onSnapshot, collection, serverTimestamp, updateDoc, increment, runTransaction, query, where, orderBy, limit, getDocs, collectionGroup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
            import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
            import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";

            const firebaseConfig = {
                apiKey: "AIzaSyBd55v6rN7ngtaoXIwuQb0lHy0p8_69dzU",
                authDomain: "skatequest-666.firebaseapp.com",
                projectId: "skatequest-666",
                storageBucket: "skatequest-666.firebasestorage.app",
                messagingSenderId: "614575814578",
                appId: "1:614575814578:web:758b0842447a0e9269d6ab",
                measurementId: "G-ZLQZQ3CYBK"
            };

            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            const db = getFirestore(app);
            const auth = getAuth(app);
            const storage = getStorage(app);
            const functions = getFunctions(app);
            
            window.firebaseInstances = { 
                db, auth, storage, functions,
                doc, getDoc, setDoc, addDoc, onSnapshot, collection, 
                serverTimestamp, updateDoc, increment, runTransaction, 
                query, where, orderBy, limit, getDocs, collectionGroup,
                ref, uploadBytes, getDownloadURL, 
                signInAnonymously, onAuthStateChanged, 
                httpsCallable,
                appId: firebaseConfig.appId 
            };
            console.log('‚úì Firebase initialized');
        </script>

        <!-- App Scripts -->
        <script src="app.js?v=2.0" defer></script>
        <script src="pwa.js?v=2.0" defer></script>
    </body>
</html>
